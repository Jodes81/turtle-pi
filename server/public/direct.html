<!DOCTYPE html>
<html>
    <head>
        <title>Turtle Direct Control</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="css/main.css" />
        <link rel="stylesheet" href="css/led.css" />
        <link rel="stylesheet" href="css/turtle.css" />
        <link rel="stylesheet" href="css/joystick.css" />

        <link rel="stylesheet" href="css/jquery.mobile.custom.complete.theme.min.css"/>
        <link rel="stylesheet" href="css/jquery.mobile.custom.complete.structure.min.css"/>
        <script src="lib/jquery.js"></script>
        <script src="lib/jquery.mobile.custom.complete.min.js"></script>
        
        <script src="lib/jquery.svg.min.js"></script>
        <script src="lib/jquery.svganim.min.js"></script>
        <script src="lib/jquery.svgdom.min.js"></script>
        
        <script src="js/utils.js"></script>
        <script src="js/turtle.js"></script>
        <script src="js/wheel.js"></script>
        <script src="js/arrow.js"></script>
        <script src="js/led.js"></script>
        <script src="js/joystick.js"></script>
        <script src="js/server.js"></script>
        
        <script>
            var t, j, server;
            $(function(){
                
                j = new Joystick({selector: "div.joystick"});
                t = new Turtle({
                    selector: "div.turtle",
                    onCommand: function(wheel, direction){
                        server.send(JSON.stringify({
                            msgFor: "wheel",
                            name: wheel,
                            value: direction
                        }));
                    }
                });
                
                server = new Server({onMessage: function(event){
                    try {
                        //console.log(event.data);
                        dispatch(JSON.parse(event.data));
                    } catch (e) {
                        console.log("JSON could not be parsed:"+event.data);
                    }
                }});
                
            });
            function dispatch(msgs)
            {
                for (var i in msgs){
                    var msg = msgs[i];
                    switch (msg.msgFor)
                    {
                        case "irSensors":
                        case "wheels":
                            t.msgRx(msg);
                            break;
                        default:
                            console.log("Not recognised msgFor type: "+msg.msgFor);
                            break;
                    }
                }
            }
            
        </script>
        <style>
        </style>
    </head>
    <body>
        <div class="turtle" style="width: 300px; height: 350px"></div>
        <div class="joystick" style="width: 350px; height: 350px"></div>

    </body>
</html>
